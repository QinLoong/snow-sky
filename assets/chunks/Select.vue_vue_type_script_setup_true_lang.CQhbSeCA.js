import{d as U,k as g,h as c,a7 as W,y as x,o as i,c as u,J as p,w as v,F as q,G as z,n as b,a2 as w,p as M,b as C}from"./framework.DeBpyR9V.js";import{d as G,_ as J}from"./Tooltip.vue_vue_type_script_setup_true_lang.CwcPrBwA.js";import{_ as j}from"./Input.vue_vue_type_script_setup_true_lang.BbPoW_dR.js";import{_,i as $}from"./Icon.vue_vue_type_script_setup_true_lang.DX-V4bA_.js";import{R as Q}from"./RenderVnode.D5bQQas6.js";const T={key:0,class:"snow-select__loading"},X={key:1,class:"snow-select__nodata"},Y={key:2,class:"snow-select__menu"},Z=["id","onClick"],ie=U({name:"SnowSelect",__name:"Select",props:{modelValue:{},options:{default:()=>[]},placeholder:{},disabled:{type:Boolean},clearable:{type:Boolean},renderLabel:{},filterable:{type:Boolean},filterMethod:{},remote:{type:Boolean},remoteMethod:{}},emits:["change","update:modelValue","visible-change","clear"],setup(B,{emit:D}){const f=l=>{const n=t.options.find(a=>a.value===l);return n||null},t=B,F=g(()=>t.remote?300:0),d=D,h=f(t.modelValue),m=c(),k=c(),e=W({inputValue:h?h.label:"",selectedOption:h,mouseHover:!1,loading:!1,highlightIndex:-1});x(()=>t.modelValue,l=>{var n;e.inputValue=f(l)?(n=f(l))==null?void 0:n.label:""});const s=c(!1),R={modifiers:[{name:"offset",options:{offset:[0,9]}},{name:"sameWidth",enabled:!0,fn:({state:l})=>{l.styles.popper.width=`${l.rects.reference.width}px`},phase:"beforeWrite",requires:["computeStyles"]}]},o=c(t.options);x(()=>t.options,l=>{o.value=l});const y=async l=>{if(t.filterable){if(t.filterMethod&&$(t.filterMethod))o.value=t.filterMethod(l);else if(t.remote&&t.remoteMethod&&$(t.remoteMethod))try{o.value=await t.remoteMethod(l)}catch(n){console.error(n),o.value=[]}finally{e.loading=!1}else o.value=t.options.filter(n=>n.label.includes(l));e.highlightIndex=-1}},S=()=>{y(e.inputValue)},H=G(()=>{S()},F.value),L=g(()=>t.filterable&&e.selectedOption&&s.value?e.selectedOption.label:t.placeholder),r=l=>{l?(t.filterable&&e.selectedOption&&(e.inputValue=""),t.filterable&&y(e.inputValue),m.value.show()):(m.value.hide(),t.filterable&&(e.inputValue=e.selectedOption?e.selectedOption.label:""),e.highlightIndex=-1),s.value=l,d("visible-change",l)},E=l=>{switch(l.key){case"Enter":s.value?e.highlightIndex>0&&o.value[e.highlightIndex]?O(o.value[e.highlightIndex]):r(!1):r(!0);break;case"Escape":s.value&&r(!1);break;case"ArrowUp":l.preventDefault(),o.value.length>0&&(e.highlightIndex===-1||e.highlightIndex===0?e.highlightIndex=o.value.length-1:e.highlightIndex--);break;case"ArrowDown":l.preventDefault(),o.value.length>0&&(e.highlightIndex===-1||e.highlightIndex===o.value.length-1?e.highlightIndex=0:e.highlightIndex++);break}},A=g(()=>t.clearable&&e.mouseHover&&e.selectedOption&&e.inputValue.trim()!=""),K=()=>{e.selectedOption=null,e.inputValue="",d("clear"),d("change",""),d("update:modelValue","")},N=()=>{},P=()=>{t.disabled||(s.value?r(!1):r(!0))},O=l=>{l.disabled||(e.inputValue=l.label,e.selectedOption=l,d("change",l.value),d("update:modelValue",l.value),r(!1),k.value.ref.focus())};return(l,n)=>(i(),u("div",{class:b(["snow-select",{"is-disabled":l.disabled}]),onClick:P,onMouseenter:n[2]||(n[2]=a=>e.mouseHover=!0),onMouseleave:n[3]||(n[3]=a=>e.mouseHover=!1)},[p(J,{placement:"bottom-start",ref_key:"tooltipRef",ref:m,popperOptions:R,onClickOutside:n[1]||(n[1]=a=>r(!1)),manual:""},{content:v(()=>[e.loading?(i(),u("div",T,[p(_,{icon:"spinner",spin:""})])):l.filterable&&o.value.length===0?(i(),u("div",X," no matching data! ")):(i(),u("ul",Y,[(i(!0),u(q,null,z(o.value,(a,V)=>{var I;return i(),u("li",{key:V,class:b(["snow-select__menu-item",{"is-disabled":a.disabled,"is-selected":((I=e.selectedOption)==null?void 0:I.value)===a.value,"is-highlighted":e.highlightIndex===V}]),id:`select-item-${a.value}`,onClick:w(ee=>O(a),["stop"])},[p(M(Q),{"v-node":l.renderLabel?l.renderLabel(a):a.label},null,8,["v-node"])],10,Z)}),128))]))]),default:v(()=>[p(j,{modelValue:e.inputValue,"onUpdate:modelValue":n[0]||(n[0]=a=>e.inputValue=a),disabled:l.disabled,placeholder:L.value,ref_key:"inputRef",ref:k,readonly:!l.filterable||!s.value,onInput:M(H),onKeydown:E},{suffix:v(()=>[A.value?(i(),C(_,{key:0,icon:"circle-xmark",class:"snow-input__clear",onMousedown:w(N,["prevent"]),onClick:w(K,["stop"])})):(i(),C(_,{key:1,icon:"angle-down",class:b(["header-angle",{"is-active":s.value}])},null,8,["class"]))]),_:1},8,["modelValue","disabled","placeholder","readonly","onInput"])]),_:1},512)],34))}});export{ie as _};
